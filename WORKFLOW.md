# ProtSolM Custom Dataset Evaluation Workflow

This document outlines the complete, mandatory three-step process for running solubility predictions on a custom dataset with ProtSolM. This workflow must be followed exactly to ensure correct results.

---

### **Step 1: Format PDB Files**

This step cleans and standardizes the raw PDB files generated by ESMFold.

1.  **Navigate to the raw PDB directory:**

    ```bash
    cd /home/david_nunn/ProtSolM/data/PDBSol/esmfold_pdb
    ```

2.  **Run the formatting script:**

    ```bash
    bash ../../../format_pdb.sh
    ```

This will create a new subdirectory named `pdb_final` containing the formatted PDB files.

---

### **Step 2: Pre-process PDBs into Graph Files**

This step converts the formatted PDB files into the `.pt` graph format required by the model.

1.  **Navigate back to the project root directory:**

    ```bash
    cd ~/ProtSolM
    ```

2.  **Run the pre-processing script:**

    This script must point to the `pdb_final` directory created in the previous step.

    ```bash
    python preprocess_pdbs.py \
      --test_file data/PDBSol/test_sequences.csv \
      --pdb_path data/PDBSol/esmfold_pdb/pdb_final
    ```

This will populate the `data/PDBSol/Pdbsol_k20/processed/` directory with the necessary `.pt` files.

---

### **Step 3: Run the Final Evaluation**

With all data correctly formatted and pre-processed, you can now run the final evaluation to get solubility predictions.

1.  **From the project root, run the evaluation script:**

    ```bash
    python eval.py \
      --supv_dataset data/PDBSol \
      --feature_file data/PDBSol/PDBSol_feature.csv \
      --test_file data/PDBSol/test_sequences.csv \
      --gnn_model_path ckpt/feature512_norm_pp_attention1d_k20_h512_lr5e-4.pt \
      --test_result_dir results
    ```

The final predictions will be saved in the `results/` directory.
